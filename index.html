<html>
<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.4.1/snap.svg-min.js"></script> 
	<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="lib/foundation.min.js"></script>
	
	<link rel="stylesheet" type="text/css" media="all" href="css/foundation.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

	<title>Swish 2.0: NBA shot charts by Austin Clemens</title>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<meta name="keywords" content="NBA shot charts">
	<meta name="description" content="Interactive NBA shot chart app with support for players, teams, and complex filtering. Updated nightly.">
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:site" content="@austinclemens2">
	<meta name="twitter:creator" content="@austinclemens2">
	<meta name="twitter:title" content="Interactive NBA Shot Charts">
	<meta name="twitter:description" content="Swish: Interactive NBA shot chart app with support for players, teams, and complex filtering.">
	<meta name="twitter:image:src" content="http://www.austinclemens.com/shotcharts/twitcard.png">
</head>

<style>
/*<script type="text/javascript" charset="utf-8" src="lib/bootstrap-datepicker.js"></script>*/
/*<link rel="stylesheet" type="text/css" id="bsdp-css" href="css/datepicker3.css">*/

@import url(https://fonts.googleapis.com/css?family=Raleway:400,500,600);
@import url(https://fonts.googleapis.com/css?family=Abel:400,700);
@import url(https://fonts.googleapis.com/css?family=PT+Sans:400,700);

html {-webkit-font-smoothing: antialiased;}
h2 {font-family:PT Sans;font-weight:500;font-size:1.2em;line-height:1;color:white;margin:0;padding:0;}
h3 {font-size:1em;margin-top:4;font-family:Raleway;font-weight:700;}
a {color:white;}
a:hover {text-decoration:underline;color:white;}
select{padding-top:0;padding-bottom:0;margin:0;padding-left:15;white-space:pre}
option{white-space:pre}
body {background-color:#eef0f0;}

#spinner {position:absolute}

.head {position:absolute;font-family:Abel;font-weight:700;font-size:4.9em;color:white;margin-top:-.32em;padding:0;}
.maxwidth {max-width:940}
.banner {background-color:#b27300;border-bottom:1px solid black;border-top:1px solid #b27300;margin:0;height:4em;}
.fullWidth {width: 100%;margin-left: auto;margin-right: auto;padding:0;}
.banner_subnav {top:0em;float:none;position:relative;text-align:left;margin-bottom:1em;}
.banner_subnav li {float:none;display:inline-block;background:rgba(150, 150, 150, 0.5);border-radius: 0px 0px 3px 3px;}
.banner_subnav li a {padding:7 15 7 15;color:#000;display:block;font-size:1em;font-family:Raleway;}
.banner_subnav li.is-active {background:rgba(178, 115, 0, 0.5);border-radius: 0px 0px 3px 3px;}
.banner_subnav li:not(.is-active):hover {background:rgba(178, 115, 0, 0.5);border-radius: 0px 0px 3px 3px;}
.tab-content {display:none;}
.tab-content.is-active {display:inline;}
.under {text-decoration:underline;}
.footer {width:100%;height:7em;position:absolute;background-color:#b27300;margin-top:5em;color:white;padding-top:1.3em;border-top:1px solid black}
.button {background-color:#b27300;border-radius:2px;margin-top:10px;}
.button:hover {background-color:#705201;}
.fa {margin-right:6px;}
.input-group-label {padding:6;text-align:left}
.input-group-field {border-radius:0px;padding-top:0;padding-bottom:0;margin:0;}
.datepicker table tr td, .datepicker table tr th {border-radius:0px;}
.noborder {border-left:0;border-right:0;}
.white {color:white;}
.white:hover {color:white;}
.white:active {color:white;}
.white:visited {color:white;}
.left {border-radius:3px 0px 0px 3px;margin:0;margin-bottom:1.5em;margin-right:1px;}
.middle {border-radius: 0px 0px 0px 0px;margin:0;margin-bottom:1.5em;}
.right {border-radius:0px 3px 3px 0px;margin:0;margin-bottom:1.5em;margin-left:1px;}
.top {position:absolute;padding-left:20em;padding-top:1.4em;}
.fa-twitter:hover {color:#7EB3CD;}
.current {text-decoration:underline;}
.twit {font-family:'PT Sans';font-weight:500;font-size:1.2em;line-height:1;color:white;margin:0;padding-top:3em;margin-top:3em;}
.navigation {font-family:'PT Sans';font-weight:500;font-size:1.2em;line-height:1;color:white;margin:0;padding-top:3em;margin-top:3em;}
.navigation:hover {text-decoration:underline;color:white;}
.active{text-decoration:underline;color:black;}
.active:hover {text-decoration:underline;color:black;}
.pipe {padding-left:10px;padding-right:10px;font-family:'PT Sans';font-weight:500;font-size:1.2em;line-height:1;color:white;padding-top:3em;margin-top:3em}
</style>

<body>

<header class='banner fullWidth'>
	<div class='row'>
		<div class='small-12 columns'>
			<span class='head'>Swish 2.0</span>
			<div class='top'>
				<span class='navigation active' onclick="chleague(1)">NBA</span><span class='pipe'>|</span>
				<span class='navigation' onclick="chleague(2)">WNBA</span><span class='pipe'>|</span>
				<span class='navigation' onclick="chleague(3)">D-League</span><span class='pipe'>|</span>
				<span class='twit'><a href='https://twitter.com/AustinClemens2'><i class="fa fa-twitter fa-inverse"></i>austinclemens2</a></span>
			</div>
	</div>
</header>

<div class='row'>
	<div class='small-12 columns'>
		<ul class="banner_subnav" id='navigation'>
			<li class="is-active" data-tab='players'><a href="#players">Player Shotcharts</a></li>
			<li data-tab='teams'><a href="#teams">Team Shotcharts</a></li>
		</ul>
	</div>
</div>

<div class='row'>
	<div class='small-12 columns text-center'>
		<svg id="court" class='maxwidth' viewBox='-20 17 940 667'>
			<defs>


			</defs>
		</svg>
	</div>
</div>
<div class='row'>
	<div class='small-12 columns text-center'><br>
	</div>
</div>

<div class='row'>
	<div class='small-12 small-centered columns text-center'>
		<button class="button left" onclick='kobe_me()' href="#"><i class="fa fa-trophy"></i>Kobe me</button><button class="button middle" onclick='load_chart()' href="#"><i class="fa fa-refresh"></i>Chart it</button><button class="button right" href="#"><i class="fa fa-download" onclick='savepng'></i>Download</button>
	</div>
</div>

<div id='players' class='tab-content is-active'>
	<div class='row'>
		<div class='small-12 columns'>
			<h3>Choose a season and a player</h3>
		</div>
	</div>

	<div class='row'>
		<div class='small-4 columns'>
			<div class='input-group'>
				<span class='input-group-label'>Season</span>
				<select id='year_select'>
				</select>
			</div>
		</div>

		<div class='small-4 columns'>
			<div class='input-group'>
				<span class='input-group-label'>Type</span>
				<select id='type_select'>
					<option>Regular Season</option>
					<option>Playoffs</option>
		 			<option>All Star</option>
				</select>
			</div>
		</div>

		<div class='small-4 columns'>
			<div class='input-group'>
				<span class='input-group-label'>Player</span>
				<select id='player_select'>
				</select>
			</div>
		</div>
		<div class='small-6 columns'>
		</div>
	</div>

	<div class='row'>
		<div class='small-12 columns'>
			<h3>Choose game quarter and date range (optional)</h3>
		</div>
	</div>

	<div class='row'>
		<div class='small-4 columns'>
			<div class='input-group'>
				<span class='input-group-label'>Quarter</span>
				<select id='quarter_select'>
					<option value='all'>Complete Game</option>
					<option value="1">1st quarter</option>
					<option value="2">2nd quarter</option>
					<option value="3">3rd quarter</option>
					<option value="4">4th quarter</option>
					<option value="last4">Last 4 minutes</option>
				</select>
			</div>
		</div>

<!-- 		
		<div class='small-4 columns'>
			<div class='input-group input-daterange'>
				<input type="text" class="input-group-field" id='date1'>
				<span class='input-group-label noborder'>to</span>
				<input type="text" class="input-group-field" id='date2'>
			</div>
		</div> 
-->

		<div class='small-4 columns'>
		</div>
	</div>
</div>



<div id='teams' class='tab-content'>
	<div class='row'>
		<div class='small-12 columns'>
			<h3>Choose a season and a team</h3>
		</div>
	</div>

	<div class='row'>
		<div class='small-4 columns'>
			<div class='input-group'>
				<span class='input-group-label'>Season</span>
				<select id='tyear_select'>
				</select>
			</div>
		</div>

		<div class='small-4 columns'>
			<div class='input-group'>
				<span class='input-group-label'>Type</span>
				<select id='ttype_select'>
					<option>Regular Season</option>
					<option>Playoffs</option>
		 			<option>All Star</option>
				</select>
			</div>
		</div>

		<div class='small-4 columns'>
			<div class='input-group'>
				<span class='input-group-label'>Team</span>
				<select id='team_select'>
				</select>
			</div>
		</div>
		<div class='small-6 columns'>
		</div>
	</div>

	<div class='row'>
		<div class='small-12 columns'>
			<h3>Choose game quarter, date range, and offense or defense</h3>
		</div>
	</div>

	<div class='row'>
		<div class='small-4 columns'>
			<div class='input-group'>
				<span class='input-group-label'>Quarter</span>
				<select id='tquarter_select'>
					<option value='all'>Complete Game</option>
					<option value="1">1st quarter</option>
					<option value="2">2nd quarter</option>
					<option value="3">3rd quarter</option>
					<option value="4">4th quarter</option>
					<option value="last4">Last 4 minutes</option>
				</select>
			</div>
		</div>

<!-- 		
		<div class='small-4 columns'>
			<div class='input-group input-daterange'>
				<input type="text" class="input-group-field" id='date3'>
				<span class='input-group-label noborder'>to</span>
				<input type="text" class="input-group-field" id='date4'>
			</div>
		</div> 
-->

		<div class='small-4 columns'>
			<div class='input-group'>
				<span class='input-group-label'>Side</span>
				<select id='tside_select'>
					<option value="1">Offense</option>
					<option value="0">Defense</option>
				</select>
			</div>
		</div>

		<div class='small-4 columns'>
		</div>
	</div>

</div>

<div class='footer'>
	<div class='row'>
		<div class='small-1 columns'>
		</div>
		<div class='small-9 columns'>
			<p>© <a href='http://www.austinclemens.com/blog'>Austin Clemens</a><br>
			All data is from the <a href='http://stats.nba.com'>National Basketball Association</a>.</p>
		</div>
		<div class='small-2 columns text-left'>
			<p><a href='http://www.austinclemens.com/blog' class='white'><i class='fa fa-link fa-inverse'></i>Web</a><br>
			<a href='http://www.twitter.com/austinclemens2' class='white'><i class="fa fa-twitter fa-inverse"></i>Twitter</a><br>
			<a href='mailto:austinc@mac.com?Subject=Swish' class='white'><i class="fa fa-envelope fa-inverse"></i>Email</a></p>
		</div>
	</div>
</div>

</body>

<script defer>
var league=1
var active_tab='players'

// handle subnav tabs
$(document).ready(function(){
	$('ul.banner_subnav li').click(function(){
		active_tab = $(this).attr('data-tab');

		$('ul.banner_subnav li').removeClass('is-active');
		$('.tab-content').removeClass('is-active');
		$(this).addClass('is-active');
		$("#"+active_tab).addClass('is-active');
	})
})

// handle league selection
$('.navigation').click(function(){
	$('.navigation').removeClass('active')
	$(this).toggleClass('active');
});

function chleague(num){
	league=num
	if(league==1){url="menus_nba/year_menu.csv"}
	if(league==2){url="menus_wnba/year_menu.csv"}
	if(league==3){url="menus_dleague/year_menu.csv"}

	$("#year_select").empty()
	$("#tyear_select").empty()

	$.ajax({
		url: url,
		success: function(response){
			response=response.trim()
			response=response.split(/\r\n|\n/)

			for (var i=0; i<response.length;i++) {
				row=response[i].split(',')
				if(row[0].replace(/"/g,'')!='2012'){
					try{$('#year_select').append(new Option(row[0].replace(/"/g,'')));}catch(err){}
					try{$('#tyear_select').append(new Option(row[0].replace(/"/g,'')));}catch(err){}
				}
			}
			if(league==1){
				$('#year_select').append(new Option('Career','Career'))
				$('#year_select').change();
				$('#tyear_select').append(new Option('Career','Career'))
				$('#tyear_select').change();
			} else {
				$("#year_select").change()
				$("#tyear_select").change()
			}
		}
	});

	
}

// initialize dates
// var m = new Date();
// if (m.getUTCDate()>10){day=m.getUTCDate()}else{day='0'+m.getUTCDate()}
// var dateString = day +"/"+("0" + (m.getUTCMonth()+1)).slice(-2) +"/"+("0" + m.getUTCFullYear()).slice(-4)

// $('#date1').attr('value',dateString)
// $('#date2').attr('value',dateString)
// $('#date3').attr('value',dateString)
// $('#date4').attr('value',dateString)

// $('.input-daterange input').each(function() {
//     $(this).datepicker({
// 		format: "mm/dd/yyyy",
// 		todayHighlight: true
//     });
// });

// update player dropdown
$("#year_select").change(function() {
	splayer=$("#player_select").val()
	var year=$( "#year_select" ).val()
	console.log(league,year)
	if(league!=2){var year=year.split('-')[0]}
	$("#player_select").empty()

	if(league==1){url="menus_nba/players_"+year+".csv"}
	if(league==2){url="menus_wnba/players_"+year+".csv"}
	if(league==3){url="menus_dleague/players_"+year+".csv"}

	$.ajax({
		url: url,
		success: function(response){
			response=response.trim()
			response=response.split(/\r\n|\n/)

			for (var i=0; i<response.length;i++) {
				row=response[i].split(',')
				try{$('#player_select').append(new Option(row[0].replace(/"/g,'')));}catch(err){}
			}

			$('#player_select').val(splayer)
			if($('#player_select').val()==null){
				$("#player_select").val($("#player_select option:first").val());
			}
		}
	});
})

// update team dropdown
$("#tyear_select").change(function() {
	var year=$( "#tyear_select" ).val()
	if(league!=2){var year=year.split('-')[0]}
	$("#team_select").empty()

	if(league==1){url="menus_nba/teams_"+year+".csv"}
	if(league==2){url="menus_wnba/teams_"+year+".csv"}
	if(league==3){url="menus_dleague/teams_"+year+".csv"}

	$.ajax({
		url: url,
		success: function(response){
			response=response.trim()
			response=response.split(/\r\n|\n/)

			for (var i=0; i<response.length;i++) {
				row=response[i].split(',')
				try{$('#team_select').append(new Option(row[0].replace(/"/g,'')));}catch(err){}
			}
		}
	});
})

// chart loading
function load_chart(){
	if (active_tab=='players'){
		var season=$("#year_select").val()
		var season=season.split('-')[0]
		var type=$("#type_select").val()
		var player=$("#player_select").val()
		var quarter=$("#quarter_select").val()
		// var startdate=$("#startdate_select").val()
		// var enddate=$("#enddate_select").val()

		if(league==2){player=' '+player}

	    dict={chart_type:'1',player1:player,year:season.toString(),season:type,efficiency:'FG',quarter:quarter,league:league}
	    // console.log(dict)
	    load_pshotnew(dict)
	}

	if (active_tab=='teams'){
		var season=$("#tyear_select").val()
		var season=season.split('-')[0]
		var type=$("#ttype_select").val()
		var team=$("#team_select").val()
		var quarter=$("#tquarter_select").val()
		// var startdate=$("#tstartdate_select").val()
		// var enddate=$("#tenddate_select").val()
		var side=$("#tside_select").val()

	    dict={chart_type:'3',team:team,year:season.toString(),season:type,efficiency:'FG',quarter:quarter,side:side,league:league}
		console.log(dict)
	    load_pshotnew(dict)
	}
}

// initialize snap and first drawing
var court = Snap("#court")
draw_base()
tag_court()
draw_key()
// fake_details()

function draw_base(year) {
	if (typeof courtlines!="undefined") {
		courtlines.clear()
	}

	if (league!=2){
		// lines and rects
		var graph_box=court.rect(-30,-20,1100,1000).attr({fill:'#eef0f0'})
		var credit_box=court.rect(-30,664,1100,20).attr({fill:'#606060'})
		// var details_box=court.rect(0,30,900,20).attr({fill:'#606060'})
		var key_outer_left=court.line(306,50,306,392).attr({'shape-rendering':'crispEdges'})
		var key_outer_right=court.line(594,50,594,392).attr({'shape-rendering':'crispEdges'})
		var key_inner_left=court.line(342,50,342,392).attr({'shape-rendering':'crispEdges'})
		var key_inner_right=court.line(558,50,558,392).attr({'shape-rendering':'crispEdges'})
		var key_top=court.line(306,392,594,392).attr({'shape-rendering':'crispEdges'})
		var baseline_tick_left=court.line(252,50,252,59).attr({'shape-rendering':'crispEdges'})
		var baseline_tick_right=court.line(648,50,648,59).attr({'shape-rendering':'crispEdges'})
		var ft_tick_left=court.line(360,284,369,284).attr({'shape-rendering':'crispEdges'})
		var ft_tick_right=court.line(540,284,531,284).attr({'shape-rendering':'crispEdges'})
		var backboard=court.line(396,120.2,504,120.2).attr({'shape-rendering':'crispEdges'})
		var nocharge_tick_left=court.line(378,125.6,378,148.1).attr({'shape-rendering':'crispEdges'})
		var nocharge_tick_right=court.line(522,125.6,522,148.1).attr({'shape-rendering':'crispEdges'})
		var key_left_tick1=court.line(306,176,292.5,176).attr({'shape-rendering':'crispEdges'})
		var key_right_tick1=court.line(594,176,607.5,176).attr({'shape-rendering':'crispEdges'})
		var key_left_tick2=court.line(306,194,292.5,194).attr({'shape-rendering':'crispEdges'})
		var key_right_tick2=court.line(594,194,607.5,194).attr({'shape-rendering':'crispEdges'})
		var key_left_tick3=court.line(306,248,292.5,248).attr({'shape-rendering':'crispEdges'})
		var key_right_tick3=court.line(594,248,607.5,248).attr({'shape-rendering':'crispEdges'})
		var key_left_tick4=court.line(306,302,292.5,302).attr({'shape-rendering':'crispEdges'})
		var key_right_tick4=court.line(594,302,607.5,302).attr({'shape-rendering':'crispEdges'})
		var left_threeline=court.line(54,50,54,306).attr({'shape-rendering':'crispEdges'})
		var right_threeline=court.line(846,50,846,306).attr({'shape-rendering':'crispEdges'})
		var baseline=court.line(0,50,900,50).attr({'shape-rendering':'crispEdges','stroke-width':2})

		// arcs
		var three_arc=court.path("M54,305A427.5,427.5 1 0,0 846,305")
		var inner_ft_circle=court.path("M342,392A108,108 1 0,1 558,392").attr({ "stroke-dasharray" : [22.5,22.5]});
		var outer_ft_circle=court.path("M342,392A108,108 1 0,0 558,392")
		var hoop=court.circle(450,134.6,13.5)
		var nocharge=court.path("M378,148.1A72,72 1 0,0 522,148.1")

		//zones
		left3zone=court.line(0,306,50,306).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})
		right3zone=court.line(846,306,896,306).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})
		longleftzone=court.line(50,306,306,306).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})
		longrightzone=court.line(594,306,846,306).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})
		longcenterzone1=court.line(306,392,306,545).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})
		longcenterzone2=court.line(594,392,594,545).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})
		leftarc=court.line(246,522,186,664).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})
		rightarc=court.line(654,522,714,664).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})


		// -113.3,210    -146.7,288.6
		// slope: -2.35
		// b=-56.62

		// 113.3,210	146.7,288.6
		// slope=2.35
		// b=56.62


		// zonepaths
		left3zonepath=court.path('M0,50L0,306L54,306L54,50L0,50').attr({fill:'none',id:'zone'})
		right3zonepath=court.path('M846,50L846,306L900,306L900,50L846,50').attr({fill:'none',id:'zone'})
		leftlongzonepath=court.path('M54,50L54,306L306,306L306,50L54,50').attr({fill:'none',id:'zone'})
		rightlongzonepath=court.path('M594,50L594,306L846,306L846,50L594,50').attr({fill:'none',id:'zone'})
		keyzonepath=court.path('M306,50L306,392L594,392L594,50L306,50').attr({fill:'none',id:'zone'})
		longcenterzonepath=court.path('M594,545L594,392L306,392L306,545A427.5,427.5 1 0,0 594,545').attr({fill:'none',id:'zone'})
		insideleftarcpath=court.path('M306,545L306,306L54,306A427.5,427.5 1 0,0 306,545').attr({fill:'none',id:'zone'})
		insiderightarcpath=court.path('M594,545L594,306L846,306A427.5,427.5 0 0,1 594,545').attr({fill:'none',id:'zone'})
		leftarcpath=court.path('M246,521L186,664L0,664L0,306L54,306A427.5,427.5 0 0,0 246,521').attr({fill:'none',id:'zone'})
		rightarcpath=court.path('M654,521L714,664L900,664L900,306L846,306A427.5,427.5 0 0,1 654,521').attr({fill:'none',id:'zone'})
		centerarcpath=court.path('M246,521L186,664L714,664L654,521A427.5,427.5 0 0,1 246,521').attr({fill:'none',id:'zone'})

		// x<=-220 and y<=87.5
		// x>=220 and y<=87.5
		// x>-220 and x<-80 and y<=87.5
		// x<220 and x>80 and y<=87.5
		// y<117.5 and x>=-80 and x<=80
		// y>=117.5 and x>=-80 and x<=80 and (x^2 + y^2)<237.5^2
		// y>87.5 and x<-80 and (x^2 + y^2)<237.5^2
		// y>87.5 and x>80 and (x^2 + y^2)<237.5^2
		// y>87.5 and (x^2 + y^2)>=237.5^2 and y>(-2.35*x)-56.62
		// y>87.5 and (x^2 + y^2)>=237.5^2 and y<(2.35*x)-56.62
		// (x^2 + y^2)>=237.5^2 and y<=(-2.35*x)-56.62 and y>=(2.35*x)-56.62

		// grouping and applying attributes
		courtlines=court.group(key_outer_left,key_outer_right,key_inner_left,key_inner_right,key_top,baseline_tick_left,baseline_tick_right,ft_tick_left,ft_tick_right,backboard,nocharge_tick_left,nocharge_tick_right,key_left_tick1,key_left_tick2,key_left_tick3,key_left_tick4,key_right_tick1,key_right_tick2,key_right_tick3,key_right_tick4,left_threeline,right_threeline,three_arc,inner_ft_circle,outer_ft_circle,hoop,nocharge,baseline)
		courtlines.attr({stroke: "black",fill: "none",strokeWidth:1})
	}

	if(league==2 && parseInt(year)>2012){
		// lines and rects
		var graph_box=court.rect(-30,-20,1100,1000).attr({fill:'#eef0f0'})
		var credit_box=court.rect(-30,664,1100,20).attr({fill:'#606060'})
		// var details_box=court.rect(0,30,900,20).attr({fill:'#606060'})
		var key_outer_left=court.line(306,50,306,392).attr({'shape-rendering':'crispEdges'})
		var key_outer_right=court.line(594,50,594,392).attr({'shape-rendering':'crispEdges'})
		var key_inner_left=court.line(342,50,342,392).attr({'shape-rendering':'crispEdges'})
		var key_inner_right=court.line(558,50,558,392).attr({'shape-rendering':'crispEdges'})
		var key_top=court.line(306,392,594,392).attr({'shape-rendering':'crispEdges'})
		var baseline_tick_left=court.line(252,50,252,59).attr({'shape-rendering':'crispEdges'})
		var baseline_tick_right=court.line(648,50,648,59).attr({'shape-rendering':'crispEdges'})
		var ft_tick_left=court.line(360,284,369,284).attr({'shape-rendering':'crispEdges'})
		var ft_tick_right=court.line(540,284,531,284).attr({'shape-rendering':'crispEdges'})
		var backboard=court.line(396,120.2,504,120.2).attr({'shape-rendering':'crispEdges'})
		var nocharge_tick_left=court.line(378,125.6,378,148.1).attr({'shape-rendering':'crispEdges'})
		var nocharge_tick_right=court.line(522,125.6,522,148.1).attr({'shape-rendering':'crispEdges'})
		var key_left_tick1=court.line(306,176,292.5,176).attr({'shape-rendering':'crispEdges'})
		var key_right_tick1=court.line(594,176,607.5,176).attr({'shape-rendering':'crispEdges'})
		var key_left_tick2=court.line(306,194,292.5,194).attr({'shape-rendering':'crispEdges'})
		var key_right_tick2=court.line(594,194,607.5,194).attr({'shape-rendering':'crispEdges'})
		var key_left_tick3=court.line(306,248,292.5,248).attr({'shape-rendering':'crispEdges'})
		var key_right_tick3=court.line(594,248,607.5,248).attr({'shape-rendering':'crispEdges'})
		var key_left_tick4=court.line(306,302,292.5,302).attr({'shape-rendering':'crispEdges'})
		var key_right_tick4=court.line(594,302,607.5,302).attr({'shape-rendering':'crispEdges'})
		var left_threeline=court.line(54,50,54,144.5).attr({'shape-rendering':'crispEdges'})
		var right_threeline=court.line(846,50,846,144.5).attr({'shape-rendering':'crispEdges'})
		var baseline=court.line(0,50,900,50).attr({'shape-rendering':'crispEdges','stroke-width':2})

		// arcs
		var three_arc=court.path("M54,144.5A396,396 1 0,0 846,144.5")
		var inner_ft_circle=court.path("M342,392A108,108 1 0,1 558,392").attr({ "stroke-dasharray" : [22.5,22.5]});
		var outer_ft_circle=court.path("M342,392A108,108 1 0,0 558,392")
		var hoop=court.circle(450,134.6,13.5)
		var nocharge=court.path("M378,148.1A72,72 1 0,0 522,148.1")

		//zones
		left3zone=court.line(0,306,50,306).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})
		right3zone=court.line(846,306,896,306).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})
		longleftzone=court.line(50,306,306,306).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})
		longrightzone=court.line(594,306,846,306).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})
		longcenterzone1=court.line(306,392,306,515).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})
		longcenterzone1=court.line(594,392,594,515).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})
		leftarc=court.line(266,500,186,664).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})
		rightarc=court.line(634,500,714,664).attr({'stroke-dasharray':[6,6],'stroke-width':1,stroke:'#000',opacity:.1,'shape-rendering':'crispEdges'})

		// zonepaths
		left3zonepath=court.path('M54,50L0,50L0,306L89,306A396,396 0 0,1 54,144.5L54,50').attr({fill:'none',id:'zone'})
		right3zonepath=court.path('M846,50L900,50L900,306L811,306A396,396 1 0,0 846,144.5L846,50').attr({fill:'none',id:'zone'})
		leftlongzonepath=court.path('M54,144.5L54,50L306,50L306,306L89,306A396,396, 1 0,1 54,144.5').attr({fill:'none',id:'zone'})
		rightlongzonepath=court.path('M846,144.5L846,50L594,50L594,306L811,306A396,396, 1 0,0 846,144.5').attr({fill:'none',id:'zone'})
		keyzonepath=court.path('M306,50L306,392L594,392L594,50L306,50').attr({fill:'none',id:'zone'})
		longcenterzonepath=court.path('M594,515L594,392L306,392L306,515A396,396 1 0,0 594,515').attr({fill:'none',id:'zone'})
		insideleftarcpath=court.path('M89,306L306,306L306,515A396,396 1 0,1 89,306').attr({fill:'none',id:'zone'})
		insiderightarcpath=court.path('M811,306L594,306L594,515A396,396 1 0,0 811,306').attr({fill:'none',id:'zone'})
		leftarcpath=court.path('M269,497L186,664L0,664L0,306L89,306A396,396 0 0,0 269,497').attr({fill:'none',id:'zone'})
		rightarcpath=court.path('M631,497L714,664L900,664L900,306L811,306A396,396 0 0,1 631,497').attr({fill:'none',id:'zone'})
		centerarcpath=court.path('M269,497L186,664L714,664L631,497A396,396 0 0,1 269,497').attr({fill:'none',id:'zone'})

		// x<=-220 and y<=87.5
		// x>=220 and y<=87.5
		// x>-220 and x<-80 and y<=87.5
		// x<220 and x>80 and y<=87.5
		// y<117.5 and x>=-80 and x<=80
		// y>=117.5 and x>=-80 and x<=80 and (x^2 + y^2)<237.5^2
		// y>87.5 and x<-80 and (x^2 + y^2)<237.5^2
		// y>87.5 and x>80 and (x^2 + y^2)<237.5^2
		// y>87.5 and (x^2 + y^2)>=237.5^2 and 
		// y>87.5 and (x^2 + y^2)>=237.5^2 and 
		// (x^2 + y^2)>=237.5^2

		// grouping and applying attributes
		courtlines=court.group(key_outer_left,key_outer_right,key_inner_left,key_inner_right,key_top,baseline_tick_left,baseline_tick_right,ft_tick_left,ft_tick_right,backboard,nocharge_tick_left,nocharge_tick_right,key_left_tick1,key_left_tick2,key_left_tick3,key_left_tick4,key_right_tick1,key_right_tick2,key_right_tick3,key_right_tick4,left_threeline,right_threeline,three_arc,inner_ft_circle,outer_ft_circle,hoop,nocharge,baseline)
		courtlines.attr({stroke: "#000",fill: "none",strokeWidth:1})	
	}

	// spinner
	Snap.load("spin.svg", function (f) {
		g = f.select("g");
		g.attr({transform:'t450 340'})
		g.attr({opacity: 0});
		court.append(g)
	})
}

function tag_court() {
	var twitlink=court.text(910,678,"@AustinClemens2").attr({fontFamily:"Abel",fontSize:13,fill:'white','font-weight':500,'text-anchor':'end',cursor:'pointer'})
	coords=twitlink.getBBox()
	twitlink.click(function() {window.location="https://twitter.com/austinclemens2"})
	var bird=court.image("Twitter_logo_sm.png",coords.x-20,667.5,16,13)
	court.text(-10,678,"www.austinclemens.com/shotcharts").attr({fontFamily:"Abel",fontSize:13,fill:'white','font-weight':500})
}

function head(name,details) {
	var name=court.text(0,46,name).attr({id:'temp',fontFamily:"Raleway",fontSize:33,fill:"#505050",'text-anchor':'start','font-weight':600})
	coords=name.getBBox()
	court.text(coords.x2+15,46,details).attr({id:'temp',fontFamily:"Abel",fontSize:15,fill:'black','text-anchor':'start'})
}

function draw_key(under100) {

	if(parseInt(under100)==0){
		// color key
		var grad=court.gradient('l()'+choosecolor(-.1)+'-'+choosecolor(-.07)+'-'+choosecolor(-.04)+'-'+choosecolor(-.01)+'-'+'#ffffff'+'-'+choosecolor(.01)+'-'+choosecolor(.04)+'-'+choosecolor(.07)+'-'+choosecolor(.1))
		var keybox=court.rect(748,640,128,18,2).attr({fill:grad,'shape-rendering':'crispEdges'})
		var keytext2=court.text(743,648,"Below").attr({fontFamily:"Abel",fontSize:11,'text-anchor':'end'})
		var keytext2=court.text(743,658,"Average").attr({fontFamily:"Abel",fontSize:11,'text-anchor':'end'})
		var keytext3=court.text(881,648,"Above").attr({fontFamily:"Abel",fontSize:11,'text-anchor':'start'})
		var keytext3=court.text(881,658,"Average").attr({fontFamily:"Abel",fontSize:11,'text-anchor':'start'})
		var divider=court.line(812,640,812,658).attr({'shape-rendering':'crispEdges',stroke:'black','stroke-width':1,opacity:.3})

		// size key
		var keybox2_1=court.rect(17, 645, 8, 8, 2).attr({fill:choosecolor(.04),strokeWidth:0,'shape-rendering':'crispEdges'})
		var keybox2_2=court.rect(29, 642, 13, 13, 2).attr({fill:choosecolor(.04),strokeWidth:0,'shape-rendering':'crispEdges'})
		var keybox2_3=court.rect(46, 639, 18, 18, 2).attr({fill:choosecolor(.04),strokeWidth:0,'shape-rendering':'crispEdges'})
		var keytext2=court.text(12,648,"Few").attr({fontFamily:"Abel",fontSize:11,'text-anchor':'end'})
		var keytext2=court.text(12,658,"Shots").attr({fontFamily:"Abel",fontSize:11,'text-anchor':'end'})
		var keytext3=court.text(69,648,"Many").attr({fontFamily:"Abel",fontSize:11,'text-anchor':'start'})
		var keytext3=court.text(69,658,"Shots").attr({fontFamily:"Abel",fontSize:11,'text-anchor':'start'})
	}

	if(parseInt(under100)==1){
		var makes=court.text(871,628,"Makes").attr({fontFamily:"Abel",fontSize:13,'text-anchor':'start'})
		var misses=court.text(871,648,"Misses").attr({fontFamily:"Abel",fontSize:13,'text-anchor':'start'})
		var makeicon=court.circle(861,624,3).attr({id:'temp',fill:'none',stroke:'#00e500',strokeWidth:2});
		var missicon=court.text(858,648,'x').attr({id:'temp',fontFamily:'PT Sans',fontSize:13,'font-weight':'bold',fill:'red'})
	}
}

window.onload=function() {
	// initialize season menu

	$.ajax({
		url: "menus_nba/year_menu.csv",
		success: function(response){
			response=response.trim()
			response=response.split(/\r\n|\n/)

			for (var i=0; i<response.length;i++) {
				row=response[i].split(',')
				try{$('#year_select').append(new Option(row[0].replace(/"/g,'')));}catch(err){}
				try{$('#tyear_select').append(new Option(row[0].replace(/"/g,'')));}catch(err){}
			}
			$('#year_select').append(new Option('Career','Career'))
			$('#year_select').change();
			$('#tyear_select').append(new Option('Career','Career'))
			$('#tyear_select').change();
		}
	});

    dict={chart_type:'1',player1:'Dirk Nowitzki',year:'2011',efficiency:'FG',season:'Regular Season',quarter:'all',league:'1'}
    // league=2
    // dict={chart_type:'1',player1:' Abby Bishop',year:'2015',efficiency:'FG',season:'Regular Season',quarter:'all',league:'2'}
    // dict={chart_type:'1',player1:' Alana Beard',year:'2012',efficiency:'FG',season:'Regular Season',quarter:'all',league:'2'}
    load_pshotnew(dict)
}

function kobe_me() {

	year=Math.floor((Math.random() * 16) + 2001);
	if (year==2016){year='career'} else{year=year.toString()}

	seasontype=Math.floor((Math.random() * 2) + 1);
	if(seasontype==1){seasontype='Regular Season'}
	if(seasontype==2){seasontype='Playoffs'}

	if(year==2004 || year==2013 || year==2014 || year==2015){seasontype='Regular Season'}

	quarter=Math.floor((Math.random() * 10) + 1)
	if(quarter<6){quarter='all'}
	if(quarter==6){quarter='1'}
	if(quarter==7){quarter='2'}
	if(quarter==8){quarter='3'}
	if(quarter==9){quarter='4'}
	if(quarter==10){quarter='last4'}

	dict={chart_type:'1',player1:'Kobe Bryant',year:year,efficiency:'FG',season:seasontype,quarter:quarter,league:'1'}
	load_pshotnew(dict)
}

function savepng() {
	var svg = document.getElementById('court')
	var img = document.getElementById('png_save')

	svg.toDataURL("image/png", {
		callback: function(data) {
			img.href=data
			img.click()
		}
	})
}

function load_pshotnew(dict) {
	court.append(g)
	g.animate({opacity: 1},200);
	console.log(dict)
	try{
		$.ajax({
			url: "http://www.austinclemens.com/cgi-bin/post_numpy2.py",
			type: "post",
			datatype: "html",
			data:   dict,
			success: function(response){
				var shot_data = eval("(" + response + ")");
				// console.log(shot_data)
				if(shot_data['rows']==0){
					alert('No data!')
					g.animate({opacity: 0},200);
				} else{
					court.clear()
					draw_base(dict['year'])
					tag_court()
					draw_key(shot_data['under100'])
					drawcourt_pshot(shot_data)
				}
			}
		});
	} catch(err){
		alert("Can't load this chart.")
		g.animate({opacity: 0},200)
	}
}

function drawcourt_pshot(dictionary) {
	shot_data=dictionary['chart']
	head(dictionary['players'],dictionary['details'])

	if(dictionary['under100']==0){
		var draws=200
		var max=shot_data[0][2]
		var min=shot_data[shot_data.length-5][2]

		for(var n = 0; n < draws; n++) {
			if (shot_data[n][2]>0 && shot_data[n][5]>0.005){
				var X = shot_data[n][1]*1.8+450+9 ;
	  			var Y = shot_data[n][0]*1.8+144.5+9 ;
	  			size=choosesize(shot_data[n][2],min,max,20)

	  			var square_fg=court.rect(X,Y,0,0,2,2).attr({id:'temp',fill:choosecolor(shot_data[n][3]),stroke:'#999999',strokeWidth:0,'shape-rendering':'crispEdges'});
	  			square_fg.animate({x:X-(size/2),y:Y-(size/2),height:size,width:size},1000,mina.bounce)
	  		}
		}
	} else if (dictionary['under100']==1){
		for(var n = 0; n < shot_data.length; n++) {
			var X = shot_data[n][2]*1.8+450+9 ;
  			var Y = shot_data[n][3]*1.8+144.5+9 ;
  			if(shot_data[n][1]==1){
				color='#00e500'
				var square_fg=court.circle(X,Y,0).attr({id:'temp',fill:'none',stroke:color,strokeWidth:2});
				square_fg.animate({r:3},500,mina.bounce)
  			} else{
  				color='red'
  				var missicon=court.text(X,Y,'x').attr({id:'temp',fontFamily:'PT Sans',fontSize:0,'font-weight':'bold',fill:'red'})
  				missicon.animate({x:X-5,y:Y-5,fontSize:13},500,mina.bounce)
  			}
		}
	}

	g.animate({opacity: 0},200);
}

function choosecolor(per) {
	if (per>.09) return '#d73027';
	if (per>.06 && per<=.09) return '#f46d43';
	if (per>.03 && per<=.06) return '#fdae61';
	if (per>=0 && per<=.03) return '#fee090';
	if (per<0 && per>=-.03) return '#bfe2ee';
	if (per<-.03 && per>=-.06) return '#abd9e9';
	if (per<-.06 && per>=-.09) return '#74add1';
	if (per<-.09) return '#4575b4';
}

function choosesize(shots,min,max,side_length) {
	if (shots==0) {return 0}
	if (min==0) {var min=1}

	var shots=Math.log(shots)
	var min=Math.log(min)
	var max=Math.log(max)
	var fraction=(shots-min)/(max-min)
	var minsize=45
	var differential=(Math.pow(side_length,2)-minsize)
	var blah=Math.sqrt(fraction*differential+minsize)
	return Math.round(blah);
}

</script>

</body>
</html>